<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Reports</title>
    <style>
      body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1f1f1f;
            color: #ffffff;
        }
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }
        th {
            background-color: #333333;
        }
        tr:hover {
            background-color: #3c3c3c;
        }
        a {
            text-decoration: none;
            color: #007bff;
        }
        .logo {
            display: block;
            margin: 0 auto;
            margin-bottom: 20px;
        }
        /* Adjusting width of Name column to accommodate longer file names */
        th:nth-child(1),
        td:nth-child(1) {
            width: 30%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Adjusting width of Last Modified column */
        th:nth-child(2),
        td:nth-child(2) {
            width: 20%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Adjusting width of Size column */
        th:nth-child(3),
        td:nth-child(3) {
            width: 15%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Adjusting width of Category column */
        th:nth-child(4),
        td:nth-child(4) {
            width: 15%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Adjusting width of Test Results column */
        th:nth-child(5),
        td:nth-child(5) {
            width: 15%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sort-icon {
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <img class="logo" src="https://www.cloudfabrix.com/images/logo-light.svg" alt="CloudFabrix Logo">
    <h2>Centralized Internal File System for Automation Reports</h2>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th onclick="toggleSort()">Last Modified<span id="sortIcon" class="sort-icon">&#x25B2;</span></th>
                <th>Size</th>
                <th>Category</th> <!-- New column for Category -->
                <th>Test Results</th> <!-- New column for Test Results -->
            </tr>
        </thead>
        <tbody id="fileList">
            <!-- Files will be dynamically added here -->
        </tbody>
    </table>

    <script>
        let ascendingOrder = false;

        // Function to toggle sorting order
        function toggleSort() {
            ascendingOrder = !ascendingOrder;
            sortFiles();
            const sortIcon = document.getElementById('sortIcon');
            sortIcon.innerHTML = ascendingOrder ? '&#x25B2;' : '&#x25BC;';
        }

        // Function to sort files by timestamp
        function sortFiles() {
            const tableBody = document.getElementById('fileList');
            const rows = Array.from(tableBody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                const dateA = new Date(a.querySelector('td:nth-child(2)').textContent).getTime();
                const dateB = new Date(b.querySelector('td:nth-child(2)').textContent).getTime();

                return ascendingOrder ? dateA - dateB : dateB - dateA;
            });

            rows.forEach(row => tableBody.appendChild(row));
        }

        // Function to categorize HTML reports based on file name
        function categorizeReports(fileName) {
            if (fileName.includes('rdaf-cli')) {
                return 'RDAF CLI';
            } else if (fileName.includes('sanity')) {
                return 'BOT';
            } else if (fileName.includes('status')) {
                return 'UI/UX';
            } else if (fileName.includes('cfx_api_test')) {
                return 'API';
            } else {
                return 'Other';
            }
        }
       
        function fetchTestResults(fileURL, resultCell) {
        fetch(fileURL)
         .then(response => response.text())
         .then(data => {
            const parser = new DOMParser();
            const htmlDocument = parser.parseFromString(data, 'text/html');

            const passedElement = htmlDocument.querySelector('.passed');
            const failedElement = htmlDocument.querySelector('.failed');

            const passedTests = parseInt(passedElement.textContent);
            const failedTests = parseInt(failedElement.textContent);

            resultCell.textContent = `PASSED: ${passedTests}, FAILED: ${failedTests}`;
          })
         .catch(error => console.error('Error fetching test results:', error));
        }


        function fetchFiles() {
            fetch("./")
                .then(response => response.text())
                .then(data => {
                    const parser = new DOMParser();
                    const htmlDocument = parser.parseFromString(data, 'text/html');
                    const fileList = htmlDocument.querySelectorAll('a[href$=".html"]:not([href="testReports.html"]):not([href="reports.html"])');

                    const tableBody = document.getElementById('fileList');

                    if (fileList.length > 0) {
                        fileList.forEach(file => {
                            const fileName = file.textContent;
                            const fileURL = file.getAttribute('href');
                            const fileRow = document.createElement('tr');

                            const nameCell = document.createElement('td');
                            nameCell.innerHTML = `<a href="${fileURL}">${fileName}</a>`;
                            fileRow.appendChild(nameCell);

                            const detailsCell = document.createElement('td');
                            detailsCell.textContent = 'Unknown';
                            fileRow.appendChild(detailsCell);

                            const sizeCell = document.createElement('td');
                            sizeCell.textContent = 'Unknown';
                            fileRow.appendChild(sizeCell);

                            const categoryCell = document.createElement('td'); // New cell for Category
                            categoryCell.textContent = categorizeReports(fileName);
                            fileRow.appendChild(categoryCell);

                            const testResultsCell = document.createElement('td'); // New cell for Test Results
                            testResultsCell.textContent = ''; // Test results will be fetched later
                            fileRow.appendChild(testResultsCell);

                            tableBody.appendChild(fileRow);

                            // Fetch last modified date
                            fetch(fileURL)
                                .then(response => response.headers.get('last-modified'))
                                .then(lastModified => {
                                    if (lastModified) {
                                        detailsCell.textContent = new Date(lastModified).toLocaleString();
                                    }
                                })
                                .catch(error => console.error('Error fetching last modified date:', error));

                            // Fetch file size
                            fetch(fileURL)
                                .then(response => response.blob())
                                .then(blob => {
                                    const fileSize = (blob.size / 1024).toFixed(2);
                                    sizeCell.textContent = `${fileSize} KB`;
                                })
                                .catch(error => console.error('Error fetching file size:', error));

                            // Fetch test results
                            fetchTestResults(fileURL, testResultsCell);
                        });
                    } else {
                        const noFilesRow = document.createElement('tr');
                        noFilesRow.innerHTML = '<td colspan="5">No files found.</td>'; // Adjust colspan for new columns
                        tableBody.appendChild(noFilesRow);
                    }
                })
                .catch(error => console.error('Error fetching files:', error));
        }
        fetchFiles();
    </script>

</body>
</html>

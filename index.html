<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Reports</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1f1f1f;
            color: #ffffff;
        }
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }
        th {
            background-color: #333333;
        }
        tr:hover {
            background-color: #3c3c3c;
        }
        a {
            text-decoration: none;
            color: #007bff;
        }
        .logo {
            display: block;
            margin: 0 auto;
            margin-bottom: 20px;
        }
        th:nth-child(1), td:nth-child(1),
        th:nth-child(2), td:nth-child(2),
        th:nth-child(3), td:nth-child(3),
        th:nth-child(4), td:nth-child(4),
        th:nth-child(5), td:nth-child(5) {
            width: 20%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <img class="logo" src="https://www.cloudfabrix.com/images/logo-light.svg" alt="CloudFabrix Logo">
    <h2>Centralized Internal File System for Automation Reports</h2>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Last Modified</th>
                <th>Size</th>
                <th>Category</th>
                <th>Test Results</th>
            </tr>
        </thead>
        <tbody id="fileList">
            <!-- Files will be dynamically added here -->
        </tbody>
    </table>

    <script>
        function categorizeReports(fileName) {
            if (fileName.includes('RDAF_CLI')) {
                return 'RDAF CLI';
            } else if (fileName.includes('sanity')) {
                return 'BOT';
            } else if (fileName.includes('UI')) {
                return 'UI/UX';
            } else if (fileName.includes('API')) {
                return 'API';
            } else {
                return 'Other';
            }
        }

        function fetchFiles() {
            fetch('reports/')
                .then(response => response.text())
                .then(data => {
                    const parser = new DOMParser();
                    const htmlDocument = parser.parseFromString(data, 'text/html');
                    const fileList = htmlDocument.querySelectorAll('a[href$=".html"]');

                    const tableBody = document.getElementById('fileList');

                    if (fileList.length > 0) {
                        fileList.forEach(file => {
                            const fileName = file.textContent;
                            const fileURL = `reports/${fileName}`;
                            const fileRow = document.createElement('tr');

                            const nameCell = document.createElement('td');
                            nameCell.innerHTML = `<a href="${fileURL}">${fileName}</a>`;
                            fileRow.appendChild(nameCell);

                            const detailsCell = document.createElement('td');
                            detailsCell.textContent = 'Unknown';
                            fileRow.appendChild(detailsCell);

                            const sizeCell = document.createElement('td');
                            sizeCell.textContent = 'Unknown';
                            fileRow.appendChild(sizeCell);

                            const categoryCell = document.createElement('td');
                            categoryCell.textContent = categorizeReports(fileName);
                            fileRow.appendChild(categoryCell);

                            const testResultsCell = document.createElement('td');
                            testResultsCell.textContent = 'Unknown'; // Placeholder text
                            fileRow.appendChild(testResultsCell);

                            tableBody.appendChild(fileRow);

                            // Fetch last modified date
                            fetch(fileURL)
                                .then(response => response.headers.get('last-modified'))
                                .then(lastModified => {
                                    if (lastModified) {
                                        detailsCell.textContent = new Date(lastModified).toLocaleString();
                                    }
                                })
                                .catch(error => console.error('Error fetching last modified date:', error));

                            // Fetch file size
                            fetch(fileURL)
                                .then(response => response.blob())
                                .then(blob => {
                                    const fileSize = (blob.size / 1024).toFixed(2);
                                    sizeCell.textContent = `${fileSize} KB`;
                                })
                                .catch(error => console.error('Error fetching file size:', error));
                            
                            // Fetch test results
                            fetch(fileURL)
                                .then(response => response.text())
                                .then(data => {
                                    const parser = new DOMParser();
                                    const htmlDocument = parser.parseFromString(data, 'text/html');
                                    const passedElement = htmlDocument.querySelector('.passed');
                                    const failedElement = htmlDocument.querySelector('.failed');

                                    if (passedElement && failedElement) {
                                        const passedTests = parseInt(passedElement.textContent);
                                        const failedTests = parseInt(failedElement.textContent);
                                        testResultsCell.textContent = `PASSED: ${passedTests}, FAILED: ${failedTests}`;
                                    } else {
                                        testResultsCell.textContent = 'Unknown';
                                    }
                                })
                                .catch(error => console.error('Error fetching test results:', error));
                        });
                    } else {
                        const noFilesRow = document.createElement('tr');
                        noFilesRow.innerHTML = '<td colspan="5">No files found.</td>';
                        tableBody.appendChild(noFilesRow);
                    }
                })
                .catch(error => console.error('Error fetching files:', error));
        }

        fetchFiles();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation Reports</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1f1f1f;
            color: #ffffff;
        }
        h2 {
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #333333;
        }
        th {
            background-color: #333333;
        }
        tr:hover {
            background-color: #3c3c3c;
        }
        a {
            text-decoration: none;
            color: #007bff;
        }
        .logo {
            display: block;
            margin: 0 auto;
            margin-bottom: 20px;
        }
        th:nth-child(1), td:nth-child(1),
        th:nth-child(2), td:nth-child(2),
        th:nth-child(3), td:nth-child(3),
        th:nth-child(4), td:nth-child(4),
        th:nth-child(5), td:nth-child(5) {
            width: 20%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <img class="logo" src="https://www.cloudfabrix.com/images/logo-light.svg" alt="CloudFabrix Logo">
    <h2>Centralized Internal File System for Automation Reports</h2>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Last Modified</th>
                <th>Size</th>
                <th>Category</th>
                <th>Test Results</th>
            </tr>
        </thead>
        <tbody id="fileList">
            <!-- Files will be dynamically added here -->
        </tbody>
    </table>

    <script>
        async function fetchReports() {
            const response = await fetch('reports/');
            const text = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');
            const links = Array.from(doc.querySelectorAll('a[href$=".html"]'));
            const tableBody = document.getElementById('fileList');

            if (links.length > 0) {
                links.forEach(link => {
                    const fileName = link.getAttribute('href');
                    const fileURL = `reports/${fileName}`;
                    const fileRow = document.createElement('tr');

                    const nameCell = document.createElement('td');
                    nameCell.innerHTML = `<a href="${fileURL}">${fileName}</a>`;
                    fileRow.appendChild(nameCell);

                    const detailsCell = document.createElement('td');
                    detailsCell.textContent = 'Unknown';
                    fileRow.appendChild(detailsCell);

                    const sizeCell = document.createElement('td');
                    sizeCell.textContent = 'Unknown';
                    fileRow.appendChild(sizeCell);

                    const categoryCell = document.createElement('td');
                    categoryCell.textContent = categorizeReports(fileName);
                    fileRow.appendChild(categoryCell);

                    const testResultsCell = document.createElement('td');
                    testResultsCell.textContent = 'Unknown';
                    fileRow.appendChild(testResultsCell);

                    tableBody.appendChild(fileRow);

                    fetch(fileURL)
                        .then(response => {
                            detailsCell.textContent = new Date(response.headers.get('last-modified')).toLocaleString();
                            response.blob().then(blob => {
                                sizeCell.textContent = `${(blob.size / 1024).toFixed(2)} KB`;
                            });
                            return response.text();
                        })
                        .then(data => {
                            const reportDoc = parser.parseFromString(data, 'text/html');
                            const passed = reportDoc.querySelector('.passed');
                            const failed = reportDoc.querySelector('.failed');
                            if (passed && failed) {
                                testResultsCell.textContent = `PASSED: ${passed.textContent}, FAILED: ${failed.textContent}`;
                            } else {
                                testResultsCell.textContent = 'N/A';
                            }
                        })
                        .catch(error => console.error('Error fetching file details:', error));
                });
            } else {
                const noFilesRow = document.createElement('tr');
                noFilesRow.innerHTML = '<td colspan="5">No files found.</td>';
                tableBody.appendChild(noFilesRow);
            }
        }

        function categorizeReports(fileName) {
            if (fileName.includes('RDAF_CLI')) {
                return 'RDAF CLI';
            } else if (fileName.includes('sanity')) {
                return 'BOT';
            } else if (fileName.includes('UI')) {
                return 'UI/UX';
            } else if (fileName.includes('API')) {
                return 'API';
            } else {
                return 'Other';
            }
        }

        fetchReports();
    </script>
</body>
</html>
